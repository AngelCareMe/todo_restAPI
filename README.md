# todo_restAPI

Простое REST API для управления задачами (To-Do List), написанное на языке Go с использованием PostgreSQL в качестве базы данных и Fiber в качестве веб-фреймворка. API позволяет создавать, получать, обновлять и удалять задачи.

## Возможности
- Создание задачи с заголовком и описанием.
- Получение списка всех задач, отсортированного по дате создания.
- Обновление задачи (заголовок, описание, статус).
- Удаление задачи по идентификатору.
- Хранение данных в базе данных PostgreSQL.
- Развёртывание приложения и базы данных с помощью Docker и docker-compose.

## Технологии
- **Язык программирования**: Go 1.24
- **Веб-фреймворк**: Fiber v2
- **База данных**: PostgreSQL 15 (драйвер pgx/v5)
- **Контейнеризация**: Docker, docker-compose
- **Управление зависимостями**: Go Modules (`go.mod`)

## Структура проекта
- `main.go`: Точка входа приложения, настройка сервера и маршрутов.
- `db/db.go`: Логика взаимодействия с базой данных (подключение, создание таблицы, CRUD-операции).
- `handlers/handlers.go`: Обработчики HTTP-запросов для API endpoints.
- `models/model.go`: Определение структуры данных `Task`.
- `.env`: Файл с переменными окружения для конфигурации подключения к базе данных.
- `Dockerfile`: Инструкции для сборки Docker-образа приложения.
- `docker-compose.yml`: Конфигурация для запуска приложения и базы данных в контейнерах.
- `go.mod`, `go.sum`: Файлы для управления зависимостями Go.

## Требования
- Go 1.24 или новее (для локальной разработки).
- Docker и docker-compose (для запуска в контейнерах).
- PostgreSQL (для локального запуска без Docker).
- Postman, cURL или аналогичный инструмент для тестирования API.

## Установка и запуск

### 1. Клонирование репозитория
Склонируйте репозиторий на ваш компьютер:
```bash
git clone <URL_репозитория>
cd todo_restAPI
```

### 2. Настройка файла `.env`
Создайте файл `.env` в корневой папке проекта (или используйте существующий) со следующими переменными окружения:
```env
DB_HOST=db
DB_PORT=5432
DB_USER=user
DB_PASS=pass
DB_NAME=todoapi
DB_SSLMODE=disable
```

**Описание переменных**:
- `DB_HOST`: Хост базы данных (в Docker — имя сервиса `db`).
- `DB_PORT`: Порт PostgreSQL (по умолчанию 5432).
- `DB_USER`: Имя пользователя базы данных.
- `DB_PASS`: Пароль пользователя базы данных.
- `DB_NAME`: Имя базы данных.
- `DB_SSLMODE`: Режим SSL (обычно `disable` для локальной разработки).

### 3. Запуск с помощью Docker
1. Убедитесь, что Docker и docker-compose установлены.
2. Выполните команду для сборки и запуска:
   ```bash
   docker-compose up --build
   ```
3. Приложение будет доступно по адресу `http://localhost:3000`.
4. База данных PostgreSQL будет запущена на порту `5432`.

Для остановки контейнеров используйте:
```bash
docker-compose down
```

### 4. Локальный запуск (без Docker)
1. Установите PostgreSQL локально и создайте базу данных с именем `todoapi`.
2. Настройте файл `.env` с правильными учетными данными для вашей базы данных.
3. Установите зависимости проекта:
   ```bash
   go mod download
   ```
4. Запустите приложение:
   ```bash
   go run main.go
   ```
5. Сервер будет доступен по адресу `http://localhost:3000`.

## API Endpoints

API предоставляет следующие endpoints для управления задачами:

### 1. Создание задачи
- **Метод**: POST
- **URL**: `/tasks`
- **Заголовки**: `Content-Type: application/json`
- **Тело запроса** (JSON):
  ```json
  {
      "title": "Новая задача",
      "description": "Описание задачи"
  }
  ```
- **Успешный ответ**: Код `201 Created`, тело ответа — созданная задача:
  ```json
  {
      "id": 1,
      "title": "Новая задача",
      "description": "Описание задачи",
      "status": "new",
      "created_at": "2025-05-17T14:00:00Z",
      "updated_at": "2025-05-17T14:00:00Z"
  }
  ```
- **Ошибки**:
  - `400 Bad Request`: Если поле `title` пустое (`{"error": "title is required"}`) или проблемы с базой данных.

### 2. Получение всех задач
- **Метод**: GET
- **URL**: `/tasks`
- **Заголовки**: Не требуются
- **Тело запроса**: Не требуется
- **Успешный ответ**: Код `200 OK`, тело ответа — массив задач:
  ```json
  [
      {
          "id": 1,
          "title": "Новая задача",
          "description": "Описание задачи",
          "status": "new",
          "created_at": "2025-05-17T14:00:00Z",
          "updated_at": "2025-05-17T14:00:00Z"
      }
  ]
  ```
- **Ошибки**:
  - `400 Bad Request`: Если возникли проблемы с базой данных.

### 3. Обновление задачи
- **Метод**: PUT
- **URL**: `/tasks/:id` (например, `/tasks/1`)
- **Заголовки**: `Content-Type: application/json`
- **Тело запроса** (JSON):
  ```json
  {
      "title": "Обновленная задача",
      "description": "Новое описание",
      "status": "in_progress"
  }
  ```
- **Успешный ответ**: Код `200 OK`, тело ответа — обновленная задача:
  ```json
  {
      "id": 1,
      "title": "Обновленная задача",
      "description": "Новое описание",
      "status": "in_progress",
      "created_at": "2025-05-17T14:00:00Z",
      "updated_at": "2025-05-17T14:05:00Z"
  }
  ```
- **Ошибки**:
  - `400 Bad Request`: Если поле `title` пустое (`{"error": "title is required"}`), ID некорректен (`{"error": "invalid id"}`) или задача не найдена (`{"error": "task with id 1 not found"}`).

### 4. Удаление задачи
- **Метод**: DELETE
- **URL**: `/tasks/:id` (например, `/tasks/1`)
- **Заголовки**: Не требуются
- **Тело запроса**: Не требуется
- **Успешный ответ**: Код `204 No Content`, тело ответа отсутствует.
- **Ошибки**:
  - `400 Bad Request`: Если ID некорректен (`{"error": "invalid id"}`) или задача не найдена (`{"error": "task with id 1 not found"}`).

## Тестирование API
Для тестирования API рекомендуется использовать Postman, cURL или аналогичный инструмент. Пример запроса в Postman:

### Пример: Создание задачи
1. Откройте Postman и создайте новый запрос.
2. Установите:
   - Метод: POST
   - URL: `http://localhost:3000/tasks`
   - Заголовок: `Content-Type: application/json`
   - Тело (raw, JSON):
     ```json
     {
         "title": "Тестовая задача",
         "description": "Тестовое описание"
     }
     ```
3. Отправьте запрос.
4. Ожидаемый ответ: Код `201 Created` с объектом созданной задачи.

### Дополнительные рекомендации
- Создайте коллекцию в Postman для сохранения всех запросов (POST, GET, PUT, DELETE).
- Проверьте обработку ошибок, отправив некорректные данные (например, пустой `title` или неверный `status`).
- Используйте последовательность: создайте задачу, затем используйте её `id` для обновления или удаления.

## Структура базы данных
Таблица `tasks` создаётся автоматически при запуске приложения (функция `CreateTable` в `db/db.go`). Схема таблицы:
```sql
CREATE TABLE IF NOT EXISTS tasks (
    id serial PRIMARY KEY,
    title TEXT NOT NULL,
    description TEXT,
    status TEXT CHECK (status IN ('new', 'in_progress', 'done')) DEFAULT 'new',
    created_at TIMESTAMP NOT NULL DEFAULT now(),
    updated_at TIMESTAMP NOT NULL DEFAULT now()
);
```

**Поля**:
- `id`: Уникальный идентификатор задачи (автоинкремент).
- `title`: Заголовок задачи (обязательное поле).
- `description`: Описание задачи (опционально).
- `status`: Статус задачи (`new`, `in_progress`, `done`).
- `created_at`: Время создания задачи.
- `updated_at`: Время последнего обновления задачи.

## Разработка
- **Добавление новых endpoints**: Модифицируйте `handlers/handlers.go` для создания новых обработчиков и добавьте маршруты в `main.go`.
- **Изменение структуры базы данных**: Обновите функцию `db.CreateTable` в `db/db.go` для изменения схемы таблицы.
- **Добавление зависимостей**: Используйте `go get` для добавления новых пакетов и обновления `go.mod`.

## Устранение неполадок
- **Ошибка подключения к базе данных**:
  - Проверьте правильность переменных в `.env`.
  - Убедитесь, что PostgreSQL запущена (в Docker — сервис `db`).
  - Проверьте, доступен ли порт `5432`.
- **Сервер не запускается**:
  - Убедитесь, что порт `3000` свободен.
  - Проверьте логи приложения (вывод в консоль или `docker logs`).
- **Ошибки в Docker**:
  - Убедитесь, что сервисы `app` и `db` корректно взаимодействуют через сеть `todo-network`.
  - Проверьте правильность `Dockerfile` и `docker-compose.yml`.

## Лицензия
Проект распространяется под лицензией MIT